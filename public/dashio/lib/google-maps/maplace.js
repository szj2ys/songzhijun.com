!function(t,o,i,s){"use strict";var n,e,a;n={activateCurrent:function(t){this.html_element.find("select").val(t)},getHtml:function(){var o,i,s=this,n="";if(this.ln>1){for(n+='<select class="dropdown controls '+this.o.controls_cssclass+'">',this.ShowOnMenu(this.view_all_key)&&(n+='<option value="'+this.view_all_key+'">'+this.o.view_all_text+"</option>"),i=0;i<this.ln;i+=1)this.ShowOnMenu(i)&&(n+='<option value="'+(i+1)+'">'+(this.o.locations[i].title||"#"+(i+1))+"</option>");n=t(n+="</select>").bind("change",(function(){s.ViewOnMap(this.value)}))}return o=this.o.controls_title,this.o.controls_title&&(o=t('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",fontSize:this.o.controls_on_map?"12px":"inherit",padding:"3px 10px 5px 0"}:{}).append(this.o.controls_title)),this.html_element=t('<div class="wrap_controls"></div>').append(o).append(n),this.html_element}},e={html_a:function(o,i,s){var n=this,e=i||o+1,a=s||this.o.locations[o].title,r=t('<a data-load="'+e+'" id="ullist_a_'+e+'" href="#'+e+'" title="'+a+'"><span>'+(a||"#"+(o+1))+"</span></a>");return r.css(this.o.controls_applycss?{color:"#666",display:"block",padding:"5px",fontSize:this.o.controls_on_map?"12px":"inherit",textDecoration:"none"}:{}),r.on("click",(function(o){o.preventDefault();var i=t(this).attr("data-load");n.ViewOnMap(i)})),r},activateCurrent:function(t){this.html_element.find("li").removeClass("active"),this.html_element.find("#ullist_a_"+t).parent().addClass("active")},getHtml:function(){var o,i,s=t("<ul class='ullist controls "+this.o.controls_cssclass+"'></ul>").css(this.o.controls_applycss?{margin:0,padding:0,listStyleType:"none"}:{});for(this.ShowOnMenu(this.view_all_key)&&s.append(t("<li></li>").append(e.html_a.call(this,!1,this.view_all_key,this.o.view_all_text))),i=0;i<this.ln;i++)this.ShowOnMenu(i)&&s.append(t("<li></li>").append(e.html_a.call(this,i)));return o=this.o.controls_title,this.o.controls_title&&(o=t('<div class="controls_title"></div>').css(this.o.controls_applycss?{fontWeight:"bold",padding:"3px 10px 5px 0",fontSize:this.o.controls_on_map?"12px":"inherit"}:{}).append(this.o.controls_title)),this.html_element=t('<div class="wrap_controls"></div>').append(o).append(s),this.html_element}},a=function(){function o(o){this.VERSION="0.1.2",this.errors=[],this.loaded=!1,this.dev=!0,this.markers=[],this.oMap=!1,this.view_all_key="all",this.infowindow=null,this.ln=0,this.oMap=!1,this.oBounds=null,this.map_div=null,this.canvas_map=null,this.controls_wrapper=null,this.current_control=null,this.current_index=null,this.Polyline=null,this.Polygon=null,this.Fusion=null,this.directionsService=null,this.directionsDisplay=null,this.o={map_div:"#gmap",controls_div:"#controls",generate_controls:!0,controls_type:"dropdown",controls_cssclass:"",controls_title:"",controls_on_map:!0,controls_applycss:!0,controls_position:i.maps.ControlPosition.RIGHT_TOP,type:"marker",view_all:!0,view_all_text:"View All",start:0,locations:[],commons:{},map_options:{mapTypeId:i.maps.MapTypeId.ROADMAP,zoom:1},stroke_options:{strokeColor:"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.4},directions_options:{travelMode:i.maps.TravelMode.DRIVING,unitSystem:i.maps.UnitSystem.METRIC,optimizeWaypoints:!1,provideRouteAlternatives:!1,avoidHighways:!1,avoidTolls:!1},styles:{},fusion_options:{},directions_panel:null,draggable:!1,show_infowindows:!0,show_markers:!0,infowindow_type:"bubble",listeners:{},beforeViewAll:function(){},afterViewAll:function(){},beforeShow:function(t,o,i){},afterShow:function(t,o,i){},afterCreateMarker:function(t,o,i){},beforeCloseInfowindow:function(t,o){},afterCloseInfowindow:function(t,o){},beforeOpenInfowindow:function(t,o,i){},afterOpenInfowindow:function(t,o,i){},afterRoute:function(t,o,i){},onPolylineClick:function(t){}},this.AddControl("dropdown",n),this.AddControl("list",e),t.extend(!0,this.o,o)}return o.prototype.controls={},o.prototype.create_objMap=function(){var o,s=0;for(o in this.o.styles)this.o.styles.hasOwnProperty(o)&&(0===s&&(this.o.map_options.mapTypeControlOptions={mapTypeIds:[i.maps.MapTypeId.ROADMAP]}),s++,this.o.map_options.mapTypeControlOptions.mapTypeIds.push("map_style_"+s));if(this.loaded)this.oMap.setOptions(this.o.map_options);else try{this.map_div.css({position:"relative",overflow:"hidden"}),this.canvas_map=t("<div>").addClass("canvas_map").css({width:"100%",height:"100%"}).appendTo(this.map_div),this.oMap=new i.maps.Map(this.canvas_map.get(0),this.o.map_options)}catch(t){this.errors.push(t.toString())}for(o in s=0,this.o.styles)this.o.styles.hasOwnProperty(o)&&(s++,this.oMap.mapTypes.set("map_style_"+s,new i.maps.StyledMapType(this.o.styles[o],{name:o})),this.oMap.setMapTypeId("map_style_"+s));this.debug("01")},o.prototype.add_markers_to_objMap=function(){var t,o=this.o.type||"marker";if("marker"===o)for(t=0;t<this.ln;t++)this.create.marker.call(this,t);else this.create[o].apply(this)},o.prototype.create={marker:function(o){var s,n,e,a,r=this,l=this.o.locations[o],h=(l.html,new i.maps.LatLng(l.lat,l.lon)),p=!1!==l.visible;return t.extend(l,{position:h,map:this.oMap,zIndex:1e4,visible:!1!==this.o.show_markers&&p}),l.image&&(e=l.image_w||32,a=l.image_h||32,t.extend(l,{icon:new i.maps.MarkerImage(l.image,new i.maps.Size(e,a),new i.maps.Point(0,0),new i.maps.Point(e/2,a/2))})),s=new i.maps.Marker(l),i.maps.event.addListener(s,"click",(function(){r.o.beforeShow(o,l,s),n=!1!==l.show_infowindows,r.o.show_infowindows&&n&&r.open_infowindow(o,s),r.oMap.panTo(h),l.zoom&&r.oMap.setZoom(l.zoom),r.current_control&&r.o.generate_controls&&r.current_control.activateCurrent&&r.current_control.activateCurrent.call(r,o+1),r.current_index=o,r.o.afterShow(o,l,s)})),this.oBounds.extend(h),this.markers.push(s),this.o.afterCreateMarker(o,l,s),l.visible=p,s},polyline:function(){var o,s,n=[];for(o=0;o<this.ln;o++)s=new i.maps.LatLng(this.o.locations[o].lat,this.o.locations[o].lon),n.push(s),this.create.marker.call(this,o);t.extend(this.o.stroke_options,{path:n,map:this.oMap}),this.Polyline?this.Polyline.setOptions(this.o.stroke_options):this.Polyline=new i.maps.Polyline(this.o.stroke_options)},polygon:function(){var o,s,n=this,e=[];for(o=0;o<this.ln;o++)s=new i.maps.LatLng(this.o.locations[o].lat,this.o.locations[o].lon),e.push(s),this.create.marker.call(this,o);t.extend(this.o.stroke_options,{paths:e,editable:this.o.draggable,map:this.oMap}),this.Polygon?this.Polygon.setOptions(this.o.stroke_options):this.Polygon=new i.maps.Polygon(this.o.stroke_options),i.maps.event.addListener(this.Polygon,"click",(function(t){n.o.onPolylineClick(t)}))},fusion:function(){t.extend(this.o.fusion_options,{styles:[this.o.stroke_options],map:this.oMap}),this.Fusion?this.Fusion.setOptions(this.o.fusion_options):this.Fusion=new i.maps.FusionTablesLayer(this.o.fusion_options)},directions:function(){var o,s,n,e,a,r=this,l=[],h=0;for(o=0;o<this.ln;o++)n=new i.maps.LatLng(this.o.locations[o].lat,this.o.locations[o].lon),0===o?e=n:o===this.ln-1?a=n:(s=!0===this.o.locations[o].stopover,l.push({location:n,stopover:s})),this.create.marker.call(this,o);t.extend(this.o.directions_options,{origin:e,destination:a,waypoints:l}),this.directionsService||(this.directionsService=new i.maps.DirectionsService),this.directionsDisplay?this.directionsDisplay.setOptions({draggable:this.o.draggable}):this.directionsDisplay=new i.maps.DirectionsRenderer({draggable:this.o.draggable}),this.directionsDisplay.setMap(this.oMap),this.o.directions_panel&&(this.o.directions_panel=t(this.o.directions_panel),this.directionsDisplay.setPanel(this.o.directions_panel.get(0))),this.o.draggable&&i.maps.event.addListener(this.directionsDisplay,"directions_changed",(function(){h=r.compute_distance(r.directionsDisplay.directions),r.o.afterRoute(h)})),this.directionsService.route(this.o.directions_options,(function(t,o){o===i.maps.DirectionsStatus.OK&&(h=r.compute_distance(t),r.directionsDisplay.setDirections(t)),r.o.afterRoute(h,o,t)}))}},o.prototype.compute_distance=function(t){var o,i=0,s=t.routes[0],n=s.legs.length;for(o=0;o<n;o++)i+=s.legs[o].distance.value;return i},o.prototype.type_to_open={bubble:function(t){this.infowindow=new i.maps.InfoWindow({content:t.html||""})}},o.prototype.open_infowindow=function(t,o){this.CloseInfoWindow();var i=this.o.locations[t],s=i.type||this.o.infowindow_type;i.html&&this.type_to_open[s]&&(this.o.beforeOpenInfowindow(t,i,o),this.type_to_open[s].call(this,i),this.infowindow.open(this.oMap,o),this.o.afterOpenInfowindow(t,i,o))},o.prototype.get_html_controls=function(){return this.controls[this.o.controls_type]&&this.controls[this.o.controls_type].getHtml?(this.current_control=this.controls[this.o.controls_type],this.current_control.getHtml.apply(this)):""},o.prototype.generate_controls=function(){if(!this.o.controls_on_map)return this.controls_wrapper.empty(),void this.controls_wrapper.append(this.get_html_controls());var o=t('<div class="on_gmap '+this.o.controls_type+' gmap_controls"></div>').css(this.o.controls_applycss?{margin:"5px"}:{}),i=t(this.get_html_controls()).css(this.o.controls_applycss?{background:"#fff",padding:"5px",border:"1px solid rgb(113,123,135)",boxShadow:"rgba(0, 0, 0, 0.4) 0px 2px 4px",maxHeight:this.map_div.find(".canvas_map").outerHeight()-80,minWidth:100,overflowY:"auto",overflowX:"hidden"}:{});o.append(i),this.oMap.controls[this.o.controls_position].push(o.get(0))},o.prototype.init_map=function(){var t=this,o=0;if(this.Polyline&&this.Polyline.setMap(null),this.Polygon&&this.Polygon.setMap(null),this.Fusion&&this.Fusion.setMap(null),this.directionsDisplay&&this.directionsDisplay.setMap(null),this.markers){for(o in this.markers)if(this.markers[o])try{this.markers[o].setMap(null)}catch(o){t.errors.push(o)}this.markers.length=0,this.markers=[]}this.o.controls_on_map&&this.oMap.controls&&this.oMap.controls[this.o.controls_position].forEach((function(o,i){try{t.oMap.controls[this.o.controls_position].removeAt(i)}catch(o){t.errors.push(o)}})),this.oBounds=new i.maps.LatLngBounds,this.debug("02")},o.prototype.perform_load=function(){1===this.ln?this.o.map_options.set_center?this.oMap.setCenter(new i.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):(this.oMap.setCenter(this.markers[0].getPosition()),this.ViewOnMap(1)):0===this.ln?(this.o.map_options.set_center?this.oMap.setCenter(new i.maps.LatLng(this.o.map_options.set_center[0],this.o.map_options.set_center[1])):this.oMap.fitBounds(this.oBounds),this.oMap.setZoom(this.o.map_options.zoom)):(this.oMap.fitBounds(this.oBounds),"number"==typeof(this.o.start-0)&&this.o.start>0&&this.o.start<=this.ln?this.ViewOnMap(this.o.start):this.ViewOnMap(this.view_all_key))},o.prototype.debug=function(t){this.dev&&this.errors.length&&console.log(t+": ",this.errors)},o.prototype.AddControl=function(t,o){return!(!t||!o)&&(this.controls[t]=o,!0)},o.prototype.CloseInfoWindow=function(){this.infowindow&&(this.current_index||0===this.current_index)&&(this.o.beforeCloseInfowindow(this.current_index,this.o.locations[this.current_index]),this.infowindow.close(),this.infowindow=null,this.o.afterCloseInfowindow(this.current_index,this.o.locations[this.current_index]))},o.prototype.ShowOnMenu=function(t){if(t===this.view_all_key&&this.o.view_all&&this.ln>1)return!0;if("number"==typeof((t=parseInt(t,10))-0)&&t>=0&&t<this.ln){var o=!1!==this.o.locations[t].visible,i=!1!==this.o.locations[t].on_menu;if(o&&i)return!0}return!1},o.prototype.ViewOnMap=function(t){if(t===this.view_all_key)this.o.beforeViewAll(),this.current_index=t,this.o.locations.length>0&&this.o.generate_controls&&this.current_control&&this.current_control.activateCurrent&&this.current_control.activateCurrent.apply(this,[t]),this.oMap.fitBounds(this.oBounds),this.CloseInfoWindow(),this.o.afterViewAll();else if("number"==typeof((t=parseInt(t,10))-0)&&t>0&&t<=this.ln)try{i.maps.event.trigger(this.markers[t-1],"click")}catch(t){this.errors.push(t.toString())}this.debug("03")},o.prototype.SetLocations=function(t,o){this.o.locations=t,o&&this.Load()},o.prototype.AddLocations=function(o,i){var s=this;t.isArray(o)&&t.each(o,(function(t,o){s.o.locations.push(o)})),t.isPlainObject(o)&&this.o.locations.push(o),i&&this.Load()},o.prototype.AddLocation=function(o,i,s){t.isPlainObject(o)&&this.o.locations.splice(i,0,o),s&&this.Load()},o.prototype.RemoveLocations=function(o,i){var s=this,n=0;t.isArray(o)?t.each(o,(function(t,o){o-n<s.ln&&s.o.locations.splice(o-n,1),n++})):o<this.ln&&this.o.locations.splice(o,1),i&&this.Load()},o.prototype.Loaded=function(){return this.loaded},o.prototype._init=function(){this.ln=this.o.locations.length;for(var o=0;o<this.ln;o++)t.extend(this.o.locations[o],this.o.commons),this.o.locations[o].html&&(this.o.locations[o].html=this.o.locations[o].html.replace("%index",o+1),this.o.locations[o].html=this.o.locations[o].html.replace("%title",this.o.locations[o].title||""));this.map_div=t(this.o.map_div),this.controls_wrapper=t(this.o.controls_div)},o.prototype.Load=function(o){t.extend(!0,this.o,o),o&&o.locations&&(this.o.locations=o.locations),this._init(),!1===this.o.visualRefresh?i.maps.visualRefresh=!1:i.maps.visualRefresh=!0,this.init_map(),this.create_objMap(),this.add_markers_to_objMap(),this.ln>1&&this.o.generate_controls||this.o.force_generate_controls?(this.o.generate_controls=!0,this.generate_controls()):this.o.generate_controls=!1;var s,n=this;if(this.loaded)this.perform_load();else for(s in i.maps.event.addListenerOnce(this.oMap,"idle",(function(){n.perform_load()})),i.maps.event.addListener(this.oMap,"resize",(function(){n.canvas_map.css({width:n.map_div.width(),height:n.map_div.height()})})),this.o.listeners){var e=this.oMap,a=this.o.listeners[s];this.o.listeners.hasOwnProperty(s)&&i.maps.event.addListener(this.oMap,s,(function(t){a(e,t)}))}this.loaded=!0},o}(),"function"==typeof define&&define.amd?define((function(){return a})):o.Maplace=a}(jQuery,this,google);